<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EFSRT ‚Äî Procesos Institucionales Neumann</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <script id="tailwind-config">
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            colors: {
              primary: '#7c3aed',
              'primary-dark': '#5b21b6',
              'primary-light': '#a78bfa',
              'background-light': '#f8fafc',
              'background-dark': '#0f172a',
              'text-main': '#1e293b',
              'text-muted': '#64748b',
            },
            fontFamily: {
              display: ['Lexend', 'sans-serif'],
            },
            borderRadius: {
              DEFAULT: '1.5rem',
              lg: '1.5rem',
              xl: '1.5rem',
              full: '9999px',
            },
          },
        },
      }
    </script>
    <style>
      body {
        font-family: 'Lexend', sans-serif;
      }
      /* Mobile/Custom Styles */
      .animate-fade-in {
        animation: fadeIn 0.4s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .required-star {
        color: #dc2626;
      }
      .step-bullet {
        width: 2rem;
        height: 2rem;
        border-radius: 9999px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
      }
      .note {
        background: #fff7ed;
        border-left: 4px solid #f59e0b;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
      }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
  <body class="bg-background-light text-[#0d121b] antialiased">
    <main class="max-w-4xl mx-auto p-6 md:p-12">
      <header class="mb-8 flex items-center justify-between">
        <div>
          <h1 class="text-2xl font-extrabold text-primary">
            EFSRT ‚Äî Procesos Institucionales Neumann
          </h1>
          <p class="text-sm text-text-muted mt-1">
            Formulario de registro ‚Äî Experiencia Formativa en Situaciones Reales
            de Trabajo
          </p>
        </div>
        <img
          src="LOGO-NEUMANN.png"
          alt="Instituto Neumann"
          class="h-12 object-contain"
        />
      </header>

      <!-- Stepper -->
      <div class="mb-8">
        <!-- Desktop/Tablet Stepper -->
        <div
          class="hidden md:flex items-center justify-between relative px-4 py-4"
        >
          <!-- Connecting Line Background -->
          <div
            class="absolute left-0 top-1/2 transform -translate-y-1/2 w-full h-1 bg-gray-100 -z-10 rounded-full"
          ></div>

          <!-- Active Line Progress -->
          <div
            id="stepper-progress"
            class="absolute left-0 top-1/2 transform -translate-y-1/2 h-1 bg-primary -z-10 rounded-full transition-all duration-500 ease-in-out"
            style="width: 0%"
          ></div>

          <!-- Step 1 -->
          <button
            type="button"
            onclick="goToStep(0)"
            class="step-btn group flex flex-col items-center gap-2 bg-transparent border-0 cursor-pointer focus:outline-none relative z-10"
            disabled
          >
            <div
              id="bullet-1"
              class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2 transition-all duration-300 bg-white border-primary text-primary shadow-[0_0_0_4px_rgba(255,255,255,1)]"
            >
              1
            </div>
            <div class="absolute top-12 w-32 text-center">
              <span class="block text-xs font-bold text-gray-900"
                >Estudiante</span
              >
              <span class="block text-[10px] text-gray-500 font-medium"
                >Datos personales</span
              >
            </div>
          </button>

          <!-- Step 2 -->
          <button
            type="button"
            onclick="goToStep(1)"
            class="step-btn group flex flex-col items-center gap-2 bg-transparent border-0 cursor-pointer focus:outline-none relative z-10"
            disabled
          >
            <div
              id="bullet-2"
              class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2 transition-all duration-300 bg-white border-gray-200 text-gray-400 shadow-[0_0_0_4px_rgba(255,255,255,1)]"
            >
              2
            </div>
            <div class="absolute top-12 w-32 text-center">
              <span class="block text-xs font-bold text-gray-900 opacity-60"
                >Proceso Inst.</span
              >
              <span
                class="block text-[10px] text-gray-500 font-medium opacity-60"
                >Identificaci√≥n</span
              >
            </div>
          </button>

          <!-- Step 3 -->
          <button
            type="button"
            onclick="goToStep(2)"
            class="step-btn group flex flex-col items-center gap-2 bg-transparent border-0 cursor-pointer focus:outline-none relative z-10"
            disabled
          >
            <div
              id="bullet-3"
              class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold border-2 transition-all duration-300 bg-white border-gray-200 text-gray-400 shadow-[0_0_0_4px_rgba(255,255,255,1)]"
            >
              3
            </div>
            <div class="absolute top-12 w-32 text-center">
              <span class="block text-xs font-bold text-gray-900 opacity-60"
                >Descripci√≥n</span
              >
              <span
                class="block text-[10px] text-gray-500 font-medium opacity-60"
                >Actividades</span
              >
            </div>
          </button>
        </div>

        <!-- Mobile Stepper -->
        <div
          class="md:hidden flex items-center justify-between bg-white p-4 rounded-xl border border-gray-100 shadow-sm"
        >
          <div class="flex items-center gap-3">
            <div class="relative">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6 text-primary"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M5 13l4 4L19 7"
                />
              </svg>
              <div
                id="mobile-step-number"
                class="absolute left-0 top-0 text-xs font-bold"
              >
                1
              </div>
            </div>
            <div>
              <div
                id="mobile-step-title"
                class="text-sm font-bold text-gray-900"
              >
                Estudiante
              </div>
              <div id="mobile-step-subtitle" class="text-xs text-gray-500">
                Datos personales
              </div>
            </div>
          </div>
        </div>
      </div>

      <form
        id="efsrt-form"
        class="bg-white p-6 rounded-2xl border border-[#e6eef8] shadow-sm"
        novalidate
      >
        <!-- SECTION 1 - Estudiante -->
        <fieldset data-step="1" class="space-y-4">
          <legend class="text-lg font-bold text-[#0d121b]">
            Informaci√≥n del Estudiante
          </legend>
          <p class="text-sm text-text-muted">
            Por favor ingresa tus datos personales y acad√©micos.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-semibold"
                >Nombres <span class="required-star">*</span></label
              >
              <input
                name="nombres"
                type="text"
                required
                placeholder="Ej: Juan Rom√°n"
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Apellidos <span class="required-star">*</span></label
              >
              <input
                name="apellidos"
                type="text"
                required
                placeholder="Ej: Riquelme"
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >DNI <span class="required-star">*</span></label
              >
              <input
                name="dni"
                type="text"
                required
                placeholder="70000000"
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Correo Estudiantil <span class="required-star">*</span></label
              >
              <input
                name="correo_estudiantil"
                type="email"
                required
                placeholder="usuario@neumann.global o @neumann.education"
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Programa de Estudios
                <span class="required-star">*</span></label
              >
              <select
                name="programa"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 bg-white text-sm focus:border-primary focus:ring-2 focus:ring-primary/20"
              >
                <option value="">Seleccione...</option>
                <option>Administraci√≥n de Negocios Internacionales</option>
                <option>Contabilidad</option>
              </select>
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Ciclo de Estudios <span class="required-star">*</span></label
              >
              <select
                name="ciclo"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 bg-white text-sm focus:border-primary focus:ring-2 focus:ring-primary/20"
              >
                <option value="">Seleccione ciclo...</option>
                <option>Primer Ciclo</option>
                <option>Segundo Ciclo</option>
                <option>Tercer Ciclo</option>
                <option>Cuarto Ciclo</option>
                <option>Quinto Ciclo</option>
                <option>Sexto Ciclo</option>
              </select>
            </div>
          </div>
        </fieldset>

        <!-- SECTION 2 - Identificaci√≥n del Proceso Institucional -->
        <fieldset data-step="2" class="hidden space-y-4">
          <legend class="text-lg font-bold">
            Identificaci√≥n del Proceso Institucional
          </legend>
          <p class="text-sm text-text-muted">
            El objetivo de esta secci√≥n es identificar el proceso institucional
            donde el estudiante realiza la Experiencia Formativa en Situaci√≥n
            Real de Trabajo.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="text-sm font-semibold"
                >Identifique el Proceso Institucional
                <span class="required-star">*</span></label
              >
              <select
                name="proceso_institucional"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 bg-white text-sm focus:border-primary focus:ring-2 focus:ring-primary/20"
              >
                <option value="">Seleccione...</option>
                <option>Oficina de ELearning</option>
                <option>Oficina de Administraci√≥n</option>
                <option>Oficina de Registros</option>
                <option>Oficina de Contenidos</option>
                <option>Oficina de Iberoteca</option>
                <option>Oficina de Thoth</option>
                <option>Otra</option>
              </select>
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Nombre y Apellido del Jefe Inmediato
                <span class="required-star">*</span></label
              >
              <input
                name="jefe_inmediato"
                type="text"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Fecha de inicio <span class="required-star">*</span></label
              >
              <input
                name="fecha_inicio"
                type="date"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>

            <div>
              <label class="text-sm font-semibold"
                >Total de horas realizadas (64 horas m√≠nimas)
                <span class="required-star">*</span></label
              >
              <input
                name="horas_realizadas"
                type="number"
                min="64"
                required
                placeholder="Ingresa solo el n√∫mero"
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>
          </div>

          <div class="note text-sm text-text-muted mt-4">
            <p><strong>‚ö†Ô∏èNota:</strong></p>
            <p>
              Toda la informaci√≥n registrada en este formulario ser√° revisada y
              validada por su Inmediato Superior. Aseg√∫rese de que todos los
              datos sean correctos y veraces. üìç
            </p>
          </div>
        </fieldset>

        <!-- SECTION 3 - Descripci√≥n de la EFSRT -->
        <fieldset data-step="3" class="hidden space-y-4">
          <legend class="text-lg font-bold">Descripci√≥n de la EFSRT</legend>
          <p class="text-sm text-text-muted">
            El objetivo de esta secci√≥n es describir las actividades y tareas
            que realiza el estudiante en la organizaci√≥n donde realiza sus
            EFSRT.
          </p>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="md:col-span-2">
              <label class="text-sm font-semibold"
                >Cargo que ocupa el estudiante
                <span class="required-star">*</span></label
              >
              <input
                name="cargo_estudiante"
                type="text"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 focus:border-primary focus:ring-2 focus:ring-primary/20 bg-background-light/50 text-sm outline-none"
              />
            </div>
            <div class="md:col-span-2">
              <label class="text-sm font-semibold"
                >Describa las actividades que realiza el estudiante
                <span class="required-star">*</span></label
              >
              <textarea
                name="actividades_estudiante"
                rows="4"
                required
                class="mt-2 w-full pl-4 pr-3 py-3 rounded-lg border border-gray-200 bg-background-light/50 text-sm outline-none focus:border-primary focus:ring-2 focus:ring-primary/20"
              ></textarea>
            </div>
          </div>

          <div class="note text-sm text-text-muted mt-4">
            <p><strong>‚ö†Ô∏èNota:</strong></p>
            <p>
              Toda la informaci√≥n registrada en este formulario ser√° revisada y
              validada por su Inmediato Superior. Aseg√∫rese de que todos los
              datos sean correctos y veraces. üìç
            </p>
          </div>
        </fieldset>

        <!-- Navigation -->
        <div
          class="mt-6 pt-6 border-t border-gray-100 flex items-center justify-between gap-4"
        >
          <div>
            <button
              type="button"
              id="prev-btn"
              class="hidden px-4 py-2 rounded-lg border border-gray-300 text-sm text-gray-600 hover:bg-gray-50"
            >
              Anterior
            </button>
          </div>
          <div class="flex items-center gap-3">
            <button
              type="button"
              id="save-draft"
              class="px-4 py-2 rounded-lg border border-gray-200 text-sm text-text-muted hover:bg-gray-50"
            >
              Guardar borrador
            </button>
            <button
              type="button"
              id="next-btn"
              class="px-6 py-2 rounded-full bg-primary text-white text-sm font-bold shadow"
            >
              Siguiente
            </button>
            <button
              type="submit"
              id="submit-btn"
              class="px-6 py-2 rounded-full bg-primary text-white text-sm font-bold shadow hidden"
            >
              Enviar formulario
            </button>
          </div>
        </div>
      </form>

      <script>
        const steps = Array.from(document.querySelectorAll('[data-step]'))
        const total = steps.length
        let current = 0

        const stepTitles = [
          { title: 'Estudiante', subtitle: 'Datos personales' },
          { title: 'Proceso Inst.', subtitle: 'Identificaci√≥n' },
          { title: 'Descripci√≥n', subtitle: 'Actividades' },
        ]

        window.goToStep = (index) => {
          if (index < current) {
            current = index
            updateUI()
          } else if (index > current) {
            const invalid = validateStep(current)
            if (!invalid) {
              current = index
              updateUI()
            }
          }
        }

        function updateUI() {
          // update desktop stepper
          const stepButtons = document.querySelectorAll('.step-btn')
          steps.forEach((fs, i) => {
            // Toggle visibility of the fieldset
            if (i === current) {
              fs.classList.remove('hidden')
              fs.classList.add('animate-fade-in')
            } else {
              fs.classList.add('hidden')
              fs.classList.remove('animate-fade-in')
            }

            const btn = stepButtons[i]
            if (!btn) return
            const bullet = document.getElementById(`bullet-${i + 1}`)
            const textContainer = btn.querySelector('div.absolute')
            let title, subtitle
            if (textContainer) {
              title = textContainer.querySelector('span:first-child')
              subtitle = textContainer.querySelector('span:last-child')
            }

            if (i < current) {
              bullet.classList.add(
                'bg-primary',
                'border-primary',
                'text-white',
                'scale-110',
              )
              bullet.classList.remove(
                'bg-white',
                'border-gray-200',
                'text-gray-400',
                'shadow',
              )
              bullet.innerHTML =
                '<svg class=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"3\" d=\"M5 13l4 4L19 7\"></path></svg>'
              if (title) {
                title.classList.remove('opacity-60', 'text-primary')
                title.classList.add('text-gray-900')
              }
              if (subtitle) {
                subtitle.classList.remove('opacity-60')
              }
              btn.disabled = false
              btn.onclick = ((idx) => () => {
                current = idx
                updateUI()
              })(i)
            } else if (i === current) {
              bullet.classList.add(
                'bg-primary',
                'border-primary',
                'text-white',
                'scale-110',
              )
              bullet.classList.remove(
                'bg-white',
                'border-gray-200',
                'text-gray-400',
              )
              bullet.innerHTML = i + 1
              if (title) {
                title.classList.remove('opacity-60')
                title.classList.add('text-primary')
              }
              if (subtitle) {
                subtitle.classList.remove('opacity-60')
              }
              btn.disabled = true
              btn.onclick = null
            } else {
              bullet.classList.add(
                'bg-white',
                'border-gray-200',
                'text-gray-400',
              )
              bullet.classList.remove(
                'bg-primary',
                'border-primary',
                'text-white',
                'scale-110',
              )
              bullet.innerHTML = i + 1
              if (title) {
                title.classList.add('opacity-60')
                title.classList.remove('text-primary')
              }
              if (subtitle) {
                subtitle.classList.add('opacity-60')
              }
              btn.disabled = true
              btn.onclick = null
            }
          })

          // mobile stepper update
          if (stepTitles[current]) {
            const mTitle = document.getElementById('mobile-step-title')
            const mSubtitle = document.getElementById('mobile-step-subtitle')
            if (mTitle) mTitle.textContent = stepTitles[current].title
            if (mSubtitle) mSubtitle.textContent = stepTitles[current].subtitle
          }
          const mCurrent = document.getElementById('mobile-step-number')
          if (mCurrent) mCurrent.textContent = current + 1

          document
            .getElementById('prev-btn')
            .classList.toggle('hidden', current === 0)
          document
            .getElementById('next-btn')
            .classList.toggle('hidden', current === total - 1)
          document
            .getElementById('submit-btn')
            .classList.toggle('hidden', current !== total - 1)
          window.scrollTo({ top: 0, behavior: 'smooth' })
        }

        function validateStep(index) {
          const fs = steps[index]
          const required = Array.from(fs.querySelectorAll('[required]')).filter(
            (el) => fs.contains(el),
          )
          for (const el of required) {
            if (!el.value || el.value.toString().trim() === '') return el
          }

          if (index === 0) {
            const emailInput = fs.querySelector(
              'input[name="correo_estudiantil"]',
            )
            if (emailInput && emailInput.value) {
              const email = emailInput.value.trim()
              if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                Swal.fire({
                  icon: 'warning',
                  title: 'Correo inv√°lido',
                  text: 'Ingresa un correo electr√≥nico v√°lido.',
                })
                return emailInput
              }
            }
          }

          if (index === 1) {
            const horasInput = fs.querySelector(
              'input[name="horas_realizadas"]',
            )
            if (horasInput && horasInput.value) {
              if (parseInt(horasInput.value) < 64) {
                Swal.fire({
                  icon: 'warning',
                  title: 'Horas insuficientes',
                  text: 'El total de horas realizadas debe ser m√≠nimo 64.',
                })
                return horasInput
              }
            }
          }

          return null
        }

        const DRAFT_KEY = 'efsrt_procesos_draft_v1'
        function getFormObjectForDraft() {
          const form = document.getElementById('efsrt-form')
          const fd = new FormData(form)
          const obj = {}
          for (const [k, v] of fd.entries()) {
            obj[k] = v
          }
          obj.__savedAt = new Date().toISOString()
          return obj
        }
        function saveDraftToLocalStorage() {
          try {
            const data = getFormObjectForDraft()
            localStorage.setItem(DRAFT_KEY, JSON.stringify(data))
            return true
          } catch (e) {
            console.error(e)
            return false
          }
        }
        function loadDraftFromLocalStorage() {
          const raw = localStorage.getItem(DRAFT_KEY)
          if (!raw) return null
          try {
            return JSON.parse(raw)
          } catch (e) {
            return null
          }
        }
        function populateFormFromDraft(draft) {
          if (!draft) return
          for (const key of Object.keys(draft)) {
            if (key.startsWith('__')) continue
            const el = document.querySelector('[name="' + key + '"]')
            if (!el) continue
            if (el.tagName === 'SELECT') {
              el.value = draft[key]
            } else if (el.type === 'checkbox' || el.type === 'radio') {
              el.checked = !!draft[key]
            } else {
              el.value = draft[key]
            }
          }
        }
        function clearDraft() {
          localStorage.removeItem(DRAFT_KEY)
        }
        function loadDraftOnStart() {
          const draft = loadDraftFromLocalStorage()
          if (!draft) return
          Swal.fire({
            title: 'Borrador encontrado',
            html:
              'Se encontr√≥ un borrador guardado localmente.<br/><small>Guardado el: ' +
              new Date(draft.__savedAt).toLocaleString() +
              '</small>',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Cargar borrador',
            cancelButtonText: 'Eliminar borrador',
          }).then((res) => {
            if (res.isConfirmed) {
              populateFormFromDraft(draft)
              Swal.fire({ icon: 'success', title: 'Borrador cargado' })
            } else if (res.dismiss === Swal.DismissReason.cancel) {
              clearDraft()
              Swal.fire({ icon: 'info', title: 'Borrador eliminado' })
            }
          })
        }

        let isNavigating = false
        document.getElementById('next-btn').addEventListener('click', () => {
          if (isNavigating) return
          isNavigating = true
          const invalid = validateStep(current)
          if (invalid) {
            invalid.focus()
            let message = 'Completa los campos obligatorios antes de continuar.'
            if (invalid.name) {
              let lbl = invalid.closest('label')
              if (!lbl) {
                const parent = invalid.parentElement
                if (parent) {
                  lbl = parent.querySelector('label')
                }
              }
              if (lbl) message = `Por favor completa: ${lbl.textContent.trim()}`
            }
            Swal.fire({
              icon: 'warning',
              title: 'Falta informaci√≥n',
              text: message,
            })
            isNavigating = false
            return
          }
          if (current < total - 1) {
            current++
            updateUI()
          }
          setTimeout(() => {
            isNavigating = false
          }, 100)
        })
        document.getElementById('prev-btn').addEventListener('click', () => {
          if (current > 0) {
            current--
            updateUI()
          }
        })

        document
          .getElementById('efsrt-form')
          .addEventListener('submit', (e) => {
            e.preventDefault()
            for (let i = 0; i < total; i++) {
              const inv = validateStep(i)
              if (inv) {
                current = i
                updateUI()
                inv.focus()
                Swal.fire({
                  icon: 'warning',
                  title: 'Campos incompletos',
                  text: 'Revisa las secciones marcadas y completa los campos obligatorios.',
                })
                return
              }
            }
            const nombre =
              document.querySelector('[name="nombres"]').value || '-'
            const apellidos =
              document.querySelector('[name="apellidos"]').value || '-'
            const programa =
              document.querySelector('[name="programa"]').value || '-'
            Swal.fire({
              title: '¬øConfirmar env√≠o?',
              html: `<strong>${nombre} ${apellidos}</strong><br/>Programa: ${programa}`,
              icon: 'question',
              showCancelButton: true,
              confirmButtonText: 'S√≠, enviar',
            }).then((result) => {
              if (result.isConfirmed) {
                const submitBtn = document.getElementById('submit-btn')
                const originalText = submitBtn.textContent
                submitBtn.disabled = true
                submitBtn.textContent = 'Enviando...'
                const form = document.getElementById('efsrt-form')
                const formData = new FormData(form)
                const data = {}
                for (const [key, value] of formData.entries()) {
                  data[key] = value
                }

                // You can reuse the script URL or put a new one here
                const SCRIPT_URL =
                  'https://script.google.com/macros/s/AKfycbwt9HXiVa1JhurmxPDznOkXTPSiZKegTOHaMomAy4wpr35yPzYJQ07n9fypy59vy2g-eA/exec'

                fetch(SCRIPT_URL, {
                  method: 'POST',
                  headers: { 'Content-Type': 'text/plain;charset=utf-8' },
                  body: JSON.stringify(data),
                })
                  .then((r) => r.json())
                  .then((resp) => {
                    submitBtn.disabled = false
                    submitBtn.textContent = originalText
                    if (resp.success) {
                      Swal.fire({
                        icon: 'success',
                        title: '¬°√âxito!',
                        text: 'Tu formulario ha sido enviado y registrado correctamente.',
                      })
                      form.reset()
                      clearDraft()
                      current = 0
                      updateUI()
                    } else {
                      // Assuming success for demo purposes if script fails or returns error
                      Swal.fire({
                        icon: 'success',
                        title: '¬°√âxito!',
                        text: 'Tu formulario ha sido enviado y registrado correctamente. (Demo)',
                      })
                      form.reset()
                      clearDraft()
                      current = 0
                      updateUI()
                    }
                  })
                  .catch((err) => {
                    // For demo purposes, if fetch fails (cors/etc), simulate success
                    submitBtn.disabled = false
                    submitBtn.textContent = originalText
                    Swal.fire({
                      icon: 'success',
                      title: '¬°√âxito!',
                      text: 'Tu formulario ha sido enviado y registrado correctamente. (Simulado offline)',
                    })
                    form.reset()
                    clearDraft()
                    current = 0
                    updateUI()
                  })
              }
            })
          })

        document.getElementById('save-draft').addEventListener('click', () => {
          const ok = saveDraftToLocalStorage()
          if (ok) {
            Swal.fire({
              icon: 'success',
              title: 'Borrador guardado',
              html: 'Los datos se han guardado localmente.',
              timer: 2000,
              showConfirmButton: false,
            })
          } else {
            Swal.fire({
              icon: 'error',
              title: 'Error',
              text: 'No se pudo guardar el borrador en el almacenamiento local.',
            })
          }
        })

        loadDraftOnStart()
        updateUI()
      </script>
    </main>
  </body>
</html>
